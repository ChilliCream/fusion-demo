trigger:
- main

pool:
  vmImage: ubuntu-latest

steps:
  - task: UseDotNet@2
    inputs:
      packageType: 'sdk'
      useGlobalJson: true
  - task: DotNetCoreCLI@2
    inputs:
      command: 'custom'
      custom: 'publish'
      arguments: '--os linux --arch x64 /t:PublishContainer -c Release /p:ContainerImageTags $(Version)'
      workingDirectory: './Gateway'
  - task: AzureContainerApps@1
    inputs:
      azureSubscription: 'my-subscription-service-connection'
      imageToDeploy : 'mcr.microsoft.com/azuredocs/containerapps-helloworld:latest'
      containerAppName: 'my-container-app'
      resourceGroup: 'my-container-app-rg'
      imageToDeploy: 'myregistry.azurecr.io/my-container-app:$(Build.BuildId)'